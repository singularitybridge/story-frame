<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portrait Mode Character Reference Test Results</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen py-8">
  <div class="max-w-7xl mx-auto px-4">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <h1 class="text-2xl font-bold text-gray-900 mb-2">Veo 3.1 Portrait Mode Investigation</h1>
      <p class="text-sm text-gray-600">Character References API Limitation & Workaround</p>
      <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-xs">
        <div>
          <span class="text-gray-500">Test Date:</span>
          <span class="ml-2 font-medium text-gray-900">Oct 21, 2025</span>
        </div>
        <div>
          <span class="text-gray-500">Model:</span>
          <span class="ml-2 font-medium text-gray-900">veo-3.1-generate-preview</span>
        </div>
        <div>
          <span class="text-gray-500">Resolution:</span>
          <span class="ml-2 font-medium text-gray-900">720p</span>
        </div>
        <div>
          <span class="text-gray-500">Status:</span>
          <span class="ml-2 font-medium text-green-600">Fixed ✓</span>
        </div>
      </div>
    </div>

    <!-- Critical Finding Alert -->
    <div class="bg-red-50 border-l-4 border-red-400 p-6 mb-6">
      <div class="flex items-start gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-600 mt-0.5 flex-shrink-0"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>
        <div>
          <h3 class="text-sm font-semibold text-red-900 mb-2">API Limitation Discovered</h3>
          <p class="text-sm text-red-800 leading-relaxed">
            Portrait mode (9:16) <strong>does NOT support</strong> <code class="bg-red-100 px-1 rounded">config.referenceImages</code> in Veo 3.1.
            The API returns error: <code class="bg-red-100 px-1 rounded">"Your use case is currently not supported"</code>
          </p>
        </div>
      </div>
    </div>

    <!-- Test Summary -->
    <div class="grid md:grid-cols-2 gap-6 mb-6">
      <!-- What Works -->
      <div class="bg-green-50 rounded-lg border border-green-200 p-6">
        <h2 class="text-lg font-semibold text-green-900 mb-3 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
          What Works ✓
        </h2>
        <ul class="space-y-2 text-sm text-green-800">
          <li class="flex items-start gap-2">
            <span class="text-green-600 mt-0.5">•</span>
            <span>Landscape (16:9) + character references</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-green-600 mt-0.5">•</span>
            <span>Portrait (9:16) + image-to-video (first frame)</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-green-600 mt-0.5">•</span>
            <span>Portrait (9:16) text-to-video (no refs)</span>
          </li>
        </ul>
      </div>

      <!-- What Doesn't Work -->
      <div class="bg-red-50 rounded-lg border border-red-200 p-6">
        <h2 class="text-lg font-semibold text-red-900 mb-3 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
          What Doesn't Work ✗
        </h2>
        <ul class="space-y-2 text-sm text-red-800">
          <li class="flex items-start gap-2">
            <span class="text-red-600 mt-0.5">•</span>
            <span>Portrait (9:16) + 3 character references</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-red-600 mt-0.5">•</span>
            <span>Portrait (9:16) + 1 character reference</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-red-600 mt-0.5">•</span>
            <span>Portrait (9:16) + image + character refs</span>
          </li>
        </ul>
      </div>
    </div>

    <!-- Test Results Table -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Complete Test Matrix</h2>

      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Test #</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Configuration</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">API Parameters</th>
              <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Result</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr class="bg-green-50">
              <td class="px-4 py-3 text-sm font-medium text-gray-900">1</td>
              <td class="px-4 py-3 text-sm text-gray-700">Landscape + Character Refs</td>
              <td class="px-4 py-3 text-xs font-mono text-gray-600">16:9 + config.referenceImages</td>
              <td class="px-4 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">✓ Works</span>
              </td>
            </tr>
            <tr class="bg-red-50">
              <td class="px-4 py-3 text-sm font-medium text-gray-900">2</td>
              <td class="px-4 py-3 text-sm text-gray-700">Portrait + 3 Character Refs</td>
              <td class="px-4 py-3 text-xs font-mono text-gray-600">9:16 + config.referenceImages (3)</td>
              <td class="px-4 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">✗ Not supported</span>
              </td>
            </tr>
            <tr class="bg-green-50">
              <td class="px-4 py-3 text-sm font-medium text-gray-900">3</td>
              <td class="px-4 py-3 text-sm text-gray-700">Portrait Image-to-Video</td>
              <td class="px-4 py-3 text-xs font-mono text-gray-600">9:16 + image (no refs)</td>
              <td class="px-4 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">✓ Works</span>
              </td>
            </tr>
            <tr class="bg-red-50">
              <td class="px-4 py-3 text-sm font-medium text-gray-900">4</td>
              <td class="px-4 py-3 text-sm text-gray-700">Portrait Image + Character Refs</td>
              <td class="px-4 py-3 text-xs font-mono text-gray-600">9:16 + image + config.referenceImages</td>
              <td class="px-4 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">✗ Unsupported</span>
              </td>
            </tr>
            <tr class="bg-red-50">
              <td class="px-4 py-3 text-sm font-medium text-gray-900">5</td>
              <td class="px-4 py-3 text-sm text-gray-700">Portrait + Single Character Ref</td>
              <td class="px-4 py-3 text-xs font-mono text-gray-600">9:16 + config.referenceImages (1)</td>
              <td class="px-4 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">✗ Not supported</span>
              </td>
            </tr>
            <tr class="bg-green-50">
              <td class="px-4 py-3 text-sm font-medium text-gray-900">6</td>
              <td class="px-4 py-3 text-sm text-gray-700">Portrait with Workaround</td>
              <td class="px-4 py-3 text-xs font-mono text-gray-600">9:16 + image (first ref as start frame)</td>
              <td class="px-4 py-3 text-center">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">✓ Works</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- API Comparison -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">API Parameter Comparison</h2>

      <div class="grid md:grid-cols-3 gap-4">
        <!-- Landscape (Works) -->
        <div>
          <h3 class="text-sm font-medium text-green-700 mb-2 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
            Landscape (Works)
          </h3>
          <div class="bg-gray-900 rounded-lg p-3 overflow-x-auto">
            <pre class="text-xs text-green-400"><code>{
  "model": "veo-3.1-...",
  "prompt": "...",
  "config": {
    "aspectRatio": "16:9",
    <span class="text-yellow-400">"referenceImages"</span>: [...]
  }
}</code></pre>
          </div>
        </div>

        <!-- Portrait with Refs (Fails) -->
        <div>
          <h3 class="text-sm font-medium text-red-700 mb-2 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
            Portrait + Refs (Fails)
          </h3>
          <div class="bg-gray-900 rounded-lg p-3 overflow-x-auto">
            <pre class="text-xs text-red-400"><code>{
  "model": "veo-3.1-...",
  "prompt": "...",
  "config": {
    "aspectRatio": "9:16",
    <span class="text-yellow-400">"referenceImages"</span>: [...]
  }
}
<span class="text-red-300">// Error: "not supported"</span></code></pre>
          </div>
        </div>

        <!-- Portrait Workaround (Works) -->
        <div>
          <h3 class="text-sm font-medium text-green-700 mb-2 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
            Portrait Workaround (Works)
          </h3>
          <div class="bg-gray-900 rounded-lg p-3 overflow-x-auto">
            <pre class="text-xs text-green-400"><code>{
  "model": "veo-3.1-...",
  "prompt": "...",
  <span class="text-yellow-400">"image"</span>: {
    "imageBytes": "...",
    "mimeType": "image/png"
  },
  "config": {
    "aspectRatio": "9:16"
  }
}</code></pre>
          </div>
        </div>
      </div>

      <div class="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4">
        <h4 class="text-sm font-semibold text-blue-900 mb-2">Key Difference</h4>
        <div class="text-xs text-blue-800 space-y-1">
          <p><code class="bg-blue-100 px-1 rounded">config.referenceImages</code> = Character consistency across poses (NOT supported in 9:16)</p>
          <p><code class="bg-blue-100 px-1 rounded">image</code> = Starting frame for video (WORKS in 9:16)</p>
        </div>
      </div>
    </div>

    <!-- Solution Implemented -->
    <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-6 mb-6">
      <h2 class="text-lg font-semibold text-indigo-900 mb-3 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
        Solution Implemented in geminiService.ts
      </h2>
      <div class="bg-white rounded-lg p-4 border border-indigo-200">
        <div class="text-sm text-gray-700 space-y-3">
          <p><strong>Automatic Portrait Mode Handling:</strong></p>
          <ol class="list-decimal list-inside space-y-2 ml-4">
            <li>Detect when aspectRatio === '9:16'</li>
            <li>If portrait mode + character references exist:</li>
            <ul class="list-disc list-inside ml-6 mt-1 space-y-1 text-xs">
              <li>Use <strong>first reference image</strong> as starting frame (<code class="bg-gray-100 px-1 rounded">image</code> parameter)</li>
              <li>Skip <code class="bg-gray-100 px-1 rounded">config.referenceImages</code> (which doesn't work)</li>
              <li>Log message explaining the workaround</li>
            </ul>
            <li>If landscape mode (16:9):</li>
            <ul class="list-disc list-inside ml-6 mt-1 space-y-1 text-xs">
              <li>Use normal <code class="bg-gray-100 px-1 rounded">config.referenceImages</code></li>
              <li>Full character reference support</li>
            </ul>
          </ol>
          <div class="mt-4 bg-indigo-100 rounded p-3 text-xs">
            <p class="font-medium text-indigo-900 mb-1">User Experience:</p>
            <p class="text-indigo-800">Users can now select 9:16 portrait mode with character references. The system automatically switches to image-to-video mode using the first reference as the starting frame, maintaining character consistency across scenes.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Generated Videos -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Test Video Outputs</h2>

      <div class="grid md:grid-cols-2 gap-6">
        <!-- Portrait Image-to-Video (Workaround) -->
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-3 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><line x1="12" x2="12.01" y1="18" y2="18"/></svg>
            Portrait (9:16) - Image-to-Video Workaround
          </h3>
          <div class="bg-gray-900 rounded-lg overflow-hidden border-2 border-green-400">
            <video controls class="w-full" style="max-height: 600px;">
              <source src="/test-portrait-updated-service.mp4" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>
          <div class="mt-2 space-y-1">
            <div class="text-xs text-gray-600">
              <span class="font-medium">File:</span> test-portrait-updated-service.mp4
            </div>
            <div class="text-xs text-green-600 font-medium">
              ✓ Using first reference image as starting frame
            </div>
          </div>
        </div>

        <!-- Landscape with Character Refs -->
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-3 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></svg>
            Landscape (16:9) - Character References
          </h3>
          <div class="bg-gray-900 rounded-lg overflow-hidden border-2 border-green-400">
            <video controls class="w-full">
              <source src="/test-16x9.mp4" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>
          <div class="mt-2 space-y-1">
            <div class="text-xs text-gray-600">
              <span class="font-medium">File:</span> test-16x9.mp4
            </div>
            <div class="text-xs text-green-600 font-medium">
              ✓ Using config.referenceImages (full support)
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Final Recommendations -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-3">Recommendations</h2>
      <div class="space-y-3 text-sm text-gray-700">
        <div class="flex items-start gap-3">
          <span class="text-indigo-600 font-bold">1.</span>
          <p><strong>For Portrait Videos:</strong> Use the automatic workaround (image-to-video mode with first reference as starting frame). This maintains character consistency by ensuring each scene starts with the same character appearance.</p>
        </div>
        <div class="flex items-start gap-3">
          <span class="text-indigo-600 font-bold">2.</span>
          <p><strong>For Landscape Videos:</strong> Continue using full character reference support via <code class="bg-gray-100 px-1 rounded text-xs">config.referenceImages</code>.</p>
        </div>
        <div class="flex items-start gap-3">
          <span class="text-indigo-600 font-bold">3.</span>
          <p><strong>For Best Results:</strong> If character consistency is critical, consider using landscape mode (16:9) which has full API support for character references across varied poses and angles.</p>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="mt-8 text-center text-xs text-gray-500">
      <p>Tests conducted on October 21, 2025 using Google Gemini Veo 3.1</p>
      <p class="mt-1">Commit: <code class="bg-gray-100 px-1 rounded">9077276</code> - Portrait mode workaround implemented</p>
    </div>
  </div>
</body>
</html>
